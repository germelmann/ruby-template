<style>
    h1 {
        margin-top: 0;
    }
    form input {
        text-align: center;
    }
</style>
<script>
    var code_requested = false;
    var tag = null;

    window.addEventListener('load', function() {
        $('#ti_username').on('change keyup', function(e) {
            let username = $('#ti_username').val().trim();
            if (code_requested || username.length === 0) {
                $('#bu_submit_username').prop('disabled', true);
            } else {
                $('#bu_submit_username').prop('disabled', false);
            }
        });
        $('#bu_submit_username').on('click', function(e) {
            e.preventDefault();
            let username = $('#ti_username').val().trim();
            code_requested = true;
            $('#bu_submit_username').prop('disabled', true);
            $('#ti_username').prop('readonly', true).prop('disabled', true);
            api_call('/api/request_login', {username: username}, function(data) {
                if (data.success) {
                    tag = data.tag;
                    $('#part1').slideDown();
                    $('#ti_code').focus();
                }
            });
        });
        $('#bu_submit_code').on('click', function(e) {
            console.log('yay');
            e.preventDefault();
            let code = $('#ti_code').val().trim();
            window.location.href = `/l/${tag}/${code}`;
        });
        $('#ti_username').on('keydown', function(e) {
            if (e.keyCode === 13) {
                let username = $('#ti_username').val().trim();
                if (username.length > 0)
                    $('#bu_submit_username').trigger('click');
            }
        });
        $('#ti_code').on('keydown', function(e) {
            if (e.keyCode === 13) {
                let code = $('#ti_code').val().trim();
                if (code.length > 0)
                    $('#bu_submit_code').trigger('click');
            }
        });
        $('#ti_username').focus();
    });
</script>
<div class='container'>
    <div class='row'>
        <div class='col-md-12'>

            <div class="row">
                <div class="col-md-8 offset-md-2">
                    <h1>Anmelden</h1>

                    <form id='form' autocomplete='on'>
                        <p>
                            Bitte gib deine E-Mail-Adresse ein.<br>
                            Du bekommst dann eine E-Mail mit einem Code, den du im n√§chsten Schritt eingeben musst, um angemeldet zu werden.
                        </p>
                        <div id='part0' class="input-group mb-3">
                            <input type="email" id='ti_username' class="form-control" placeholder="Bitte gib deine E-Mail-Adresse ein" autocomplete='email'>
                            <button id='bu_submit_username' class="btn btn-primary" disabled><i class="bi bi-send"></i>&nbsp;&nbsp;Code zusenden</button>
                        </div>
                        <div id='part1' class="input-group mb-3" style="display: none;">
                            <input type="text" id='ti_code' class="form-control" placeholder="Bitte gib deinen 6-stelligen Code ein." autocomplete='off'>
                            <button id='bu_submit_code' class="btn btn-primary"><i class="bi bi-sign-in"></i>&nbsp;&nbsp;Anmelden</button>
                        </div>
                        <div class='api_messages' style='display: none;'></div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
